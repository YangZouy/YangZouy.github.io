<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>react学习二 | 邹阳 の 博客</title><meta name="author" content="邹阳,3075879316@qq.com"><meta name="copyright" content="邹阳"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="前面笔记的延续">
<meta property="og:type" content="article">
<meta property="og:title" content="react学习二">
<meta property="og:url" content="http://zyydgrbk.top/2023/08/16/react-xue-xi-er/index.html">
<meta property="og:site_name" content="邹阳 の 博客">
<meta property="og:description" content="前面笔记的延续">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://zyydgrbk.oss-cn-chengdu.aliyuncs.com/images/0128be58d20fc3a801219c77e6ff8e.webp">
<meta property="article:published_time" content="2023-08-16T15:14:36.000Z">
<meta property="article:modified_time" content="2023-12-03T08:15:52.155Z">
<meta property="article:author" content="邹阳">
<meta property="article:tag" content="前端">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zyydgrbk.oss-cn-chengdu.aliyuncs.com/images/0128be58d20fc3a801219c77e6ff8e.webp"><link rel="shortcut icon" href="https://zyydgrbk.oss-cn-chengdu.aliyuncs.com/images/nobackground.png"><link rel="canonical" href="http://zyydgrbk.top/2023/08/16/react-xue-xi-er/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'react学习二',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-12-03 16:15:52'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 6.3.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://zyydgrbk.oss-cn-chengdu.aliyuncs.com/images/nobackground.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">70</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://zyydgrbk.oss-cn-chengdu.aliyuncs.com/images/0128be58d20fc3a801219c77e6ff8e.webp')"><nav id="nav"><span id="blog-info"><a href="/" title="邹阳 の 博客"><img class="site-icon" src="https://zyydgrbk.oss-cn-chengdu.aliyuncs.com/images/nobackground.png"/><span class="site-name">邹阳 の 博客</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">react学习二</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-08-16T15:14:36.000Z" title="发表于 2023-08-16 23:14:36">2023-08-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-12-03T08:15:52.155Z" title="更新于 2023-12-03 16:15:52">2023-12-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="react学习二"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="React-入门学习（十四）–-redux-基本使用"><a href="#React-入门学习（十四）–-redux-基本使用" class="headerlink" title="React 入门学习（十四）– redux 基本使用"></a>React 入门学习（十四）– redux 基本使用</h2><h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>在了解了 Antd 组件库之后，我们现在开始学习了 Redux ，在我们之前写的案例当中，例如：todolist 案例，GitHub 搜索案例当中，我们对于状态的管理，都是通过 state 来实现的，比如，我们在给兄弟组件传递数据时，需要先将数据传递给父组件，再由父组件转发 给它的子组件。这个过程十分的复杂，后来我们又学习了<strong>消息的发布订阅</strong>，我们通过 <strong>pubsub</strong> 库，实现了消息的转发，直接将数据发布，由兄弟组件订阅，实现了兄弟组件间的数据传递。但是，随着我们的需求不断地提升，我们需要进行更加复杂的数据传递，更多层次的数据交换。<strong>因此我们为何不可以将所有的数据交给一个中转站，这个中转站独立于所有的组件之外，由这个中转站来进行数据的分发，这样不管哪个组件需要数据，我们都可以很轻易的给他派发。</strong></p>
<p>而有这么一个库就可以帮助我们来实现，那就是 Redux ，它可以帮助我们实现集中式状态管理</p>
<h2 id="1-什么情况使用-Redux-？"><a href="#1-什么情况使用-Redux-？" class="headerlink" title="1. 什么情况使用 Redux ？"></a>1. 什么情况使用 Redux ？</h2><p>首先，我们先明晰 <code>Redux</code> 的作用 ，实现集中式状态管理。</p>
<p> <code>Redux</code>  适用于多交互、多数据源的场景。简单理解就是<strong>复杂</strong></p>
<p>从组件角度去考虑的话，当我们有以下的应用场景时，我们可以尝试采用 <code>Redux</code> 来实现</p>
<ol>
<li>某个组件的状态需要共享时</li>
<li>一个组件需要改变其他组件的状态时</li>
<li>一个组件需要改变全局的状态时</li>
</ol>
<p>除此之外，还有很多情况都需要使用 Redux 来实现（还没有学  hook，或许还有更好的方法）</p>
<p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20210909194446988.png" alt="image-20210909194446988"></p>
<p>（从掘友的文章里截的图）</p>
<p>这张图，非常形象的将纯 React 和 采用 Redux 的区别体现了出来</p>
<h2 id="2-Redux-的工作流程"><a href="#2-Redux-的工作流程" class="headerlink" title="2. Redux 的工作流程"></a>2. Redux 的工作流程</h2><p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20210909194900532.png" alt="image-20210909194900532"></p>
<p> 首先组件会在 Redux 中派发一个 <code>action</code> 方法，通过调用 <code>store.dispatch</code> 方法，将 <code>action</code> 对象派发给 <code>store</code> ，当 <code>store</code> 接收到 <code>action</code> 对象时，会将先前的 <code>state</code> 与传来的 <code>action</code> 一同发送给 <code>reducer</code> ，<code>reducer</code>  在接收到数据后，进行数据的更改，返回一个新的状态给 <code>store</code> ，最后由 <code>store</code> 更改 <code>state</code> </p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/11/12/16e5fd1597faec4d~tplv-t2oaga2asx-watermark.awebp" alt="img"></p>
<p>（图来自掘金社区，侵删）</p>
<h2 id="3-Redux-三个核心概念"><a href="#3-Redux-三个核心概念" class="headerlink" title="3. Redux 三个核心概念"></a>3. Redux 三个核心概念</h2><h4 id="1-store"><a href="#1-store" class="headerlink" title="1. store"></a>1. store</h4><p><code>store</code> 是 Redux 的核心，可以理解为是 Redux 的数据中台，我们可以将任何我们想要存放的数据放在 <code>store</code> 中，在我们需要使用这些数据时，我们可以从中取出相应的数据。因此我们需要先创建一个 <code>store</code> ，在 Redux 中可以使用 <code>createStore</code> API 来创建一个 <code>store</code> </p>
<p>在生产中，我们需要在 <code>src</code> 目录下的 <code>redux</code> 文件夹中新增一个 <code>store.js</code> 文件，在这个文件中，创建一个 <code>store</code> 对象，并暴露它</p>
<p>因此我们需要从 <code>redux</code> 中暴露两个方法 </p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    createStore<span class="token punctuation">,</span>
    applyMiddleware
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
</code></pre>
<p>并引入为 count 组件服务的 reducer</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> countReducer <span class="token keyword">from</span> <span class="token string">'./count_reducer'</span>
</code></pre>
<p>最后调用 <code>createStore</code> 方法来暴露 <code>store</code> </p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createStore</span><span class="token punctuation">(</span>countReducer<span class="token punctuation">,</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>这里采用了中间件，本文应该不会写到~</p>
<p>在 <code>store</code> 对象下有一些常用的内置方法</p>
<p>获取当前时刻的 <code>store</code> ，我们可以采用 <code>getStore</code> 方法</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> state <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>在前面我们的流程图中，我们需要通过 <code>store</code> 中的 <code>dispatch</code> 方法来派生一个 <code>action</code> 对象给 <code>store</code></p>
<pre class=" language-js"><code class="language-js">store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`action对象`</span></span><span class="token punctuation">)</span>
</code></pre>
<p>最后还有一个 <code>subscribe</code> 方法，这个方法可以帮助我们订阅 <code>store</code> 的改变，只要 <code>store</code> 发生改变，这个方法的回调就会执行</p>
<p>为了监听数据的更新，我们可以将 <code>subscribe</code> 方法绑定在组件挂载完毕生命周期函数上，但是这样，当我们的组件数量很多时，会比较的麻烦，因此我们可以直接将 <code>subscribe</code> 函数用来监听整个 <code>App</code>组件的变化</p>
<pre class=" language-js"><code class="language-js">store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span> <span class="token operator">&lt;</span> App <span class="token operator">/</span><span class="token operator">></span> <span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
</code></pre>
<h4 id="2-action"><a href="#2-action" class="headerlink" title="2. action"></a>2. action</h4><p><code>action</code> 是 <code>store</code> 中唯一的数据来源，一般来说，我们会通过调用 <code>store.dispatch</code> 将 action 传到 store </p>
<p>我们需要传递的 <code>action</code> 是一个对象，它必须要有一个 <code>type</code> 值</p>
<p>例如，这里我们暴露了一个用于返回一个 <code>action</code> 对象的方法</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> createIncrementAction <span class="token operator">=</span> data <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    type<span class="token punctuation">:</span> INCREMENT<span class="token punctuation">,</span>
    data
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
</code></pre>
<p>我们调用它时，会返回一个 <code>action</code> 对象</p>
<h4 id="3-reducer"><a href="#3-reducer" class="headerlink" title="3. reducer"></a>3. reducer</h4><p>在 Reducer 中，我们需要指定状态的操作类型，要做怎样的数据更新，因此这个类型是必要的。</p>
<p>reducer 会根据 action 的指示，对 state 进行对应的操作，然后返回操作后的 state </p>
<p>如下，我们对接收的 action 中传来的 type 进行判断</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">countReducer</span><span class="token punctuation">(</span>preState <span class="token operator">=</span> initState<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        type<span class="token punctuation">,</span>
        data
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token operator">=</span> action<span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> INCREMENT<span class="token punctuation">:</span>
            <span class="token keyword">return</span> preState <span class="token operator">+</span> data
        <span class="token keyword">case</span> DECREMENT<span class="token punctuation">:</span>
            <span class="token keyword">return</span> preState <span class="token operator">-</span> data
        <span class="token keyword">default</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> preState
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<p>更改数据，返回新的状态</p>
<h2 id="4-创建-constant-文件"><a href="#4-创建-constant-文件" class="headerlink" title="4. 创建 constant 文件"></a>4. 创建 constant 文件</h2><p>在我们正常的编码中，有可能会出现拼写错误的情况，但是我们会发现，拼写错误了不一定会报错，因此就会比较难搞。</p>
<p>我们可以在 <code>redux</code> 目录下，创建一个 <code>constant</code> 文件，这个文件用于定义我们代码中常用的一些变量，例如</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> INCREMENT <span class="token operator">=</span> <span class="token string">'increment'</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> DECREMENT <span class="token operator">=</span> <span class="token string">'decrement'</span>
</code></pre>
<p>将这两个单词写在 <code>constant</code> 文件中，并对外暴露，当我们需要使用时，我们可以引入这个文件，并直接使用它的名称即可</p>
<p>直接使用 <code>INCREMENT</code> 即可</p>
<h2 id="5-实现异步-action"><a href="#5-实现异步-action" class="headerlink" title="5. 实现异步 action"></a>5. 实现异步 action</h2><p>一开始，我们直接调用一个异步函数，这虽然没有什么问题，但是难道 redux 就不可以实现了吗？</p>
<pre class=" language-js"><code class="language-js">incrementAsync <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> value <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>selectNumber
    <span class="token keyword">const</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> count <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> count<span class="token punctuation">:</span> count <span class="token operator">+</span> value <span class="token operator">*</span> <span class="token number">1</span> <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<p>我们可以先尝试将它封装到 <code>action</code> 对象中调用</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> createIncrementAsyncAction <span class="token operator">=</span> <span class="token punctuation">(</span>data<span class="token punctuation">,</span> time<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 无需引入 store ，在调用的时候是由 store 调用的</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>dispatch<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">createIncrementAction</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> time<span class="token punctuation">)</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<p>当我们点击异步加操作时，我们会调用这个函数，在这个函数里接收一个延时加的时间，还有action所需的数据，和原先的区别只在于返回的时一个定时器函数</p>
<p>但是如果仅仅这样，很显然是会报错的，它默认需要接收一个对象</p>
<p>如果我们需要实现传入函数，那我们就需要告诉：你只需要默默的帮我执行以下这个函数就好！</p>
<p>这时我们就需要引入中间件，在原生的 <code>redux</code> 中暴露出 <code>applyMiddleware</code> 中间件执行函数，并引入 <code>redux-thunk</code> 中间件（需要手动下载）</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> thunk <span class="token keyword">from</span> <span class="token string">'redux-thunk'</span>
</code></pre>
<p>通过第二个参数传递下去就可以了</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createStore</span><span class="token punctuation">(</span>countReducer<span class="token punctuation">,</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>注意：异步 action 不是必须要写的，完全可以自己等待异步任务的结果后再去分发同步action</p>
<blockquote>
<p>采用 <code>react-thunk</code> 能让异步代码像同步代码一样执行，在 <code>redux</code> 中我们也是可以实现异步的，但是这样我们的代码中会有很多异步的细节，这不是我们想看到的，利用 <code>react-thunk</code> 之类的库，就能让我们只关心我们的业务</p>
</blockquote>
<h2 id="6-Redux-三大原则"><a href="#6-Redux-三大原则" class="headerlink" title="6. Redux 三大原则"></a>6. Redux 三大原则</h2><p>理解好 Redux 有助于我们更好的理解接下来的 React -Redux</p>
<h3 id="第一个原则"><a href="#第一个原则" class="headerlink" title="第一个原则"></a>第一个原则</h3><p><strong>单向数据流</strong>：整个 Redux 中，数据流向是单向的</p>
<p>UI 组件 —&gt;   action  —&gt;  store  —&gt;  reducer —&gt;  store</p>
<h3 id="第二个原则"><a href="#第二个原则" class="headerlink" title="第二个原则"></a>第二个原则</h3><p><strong>state 只读</strong>：在 Redux 中不能通过直接改变 state ，来控制状态的改变，如果想要改变 state ，则需要触发一次 action。通过 action 执行 reducer</p>
<h3 id="第三个原则"><a href="#第三个原则" class="headerlink" title="第三个原则"></a>第三个原则</h3><p><strong>纯函数执行</strong>：每一个reducer 都是一个纯函数，不会有任何副作用，返回是一个新的 state，state 改变会触发 store 中的 subscribe</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903998139400200">Redux + React-router 的入门📖和配置👩🏾‍💻教程</a></p>
<p>小册：<a target="_blank" rel="noopener" href="https://juejin.cn/book/6945998773818490884">React 进阶实践指南</a></p>
<hr>
<blockquote>
<p>非常感谢您的阅读，欢迎提出你的意见，有什么问题欢迎指出，谢谢！🎈</p>
</blockquote>
<h2 id="React-入门学习（十五）–-React-Redux-基本使用"><a href="#React-入门学习（十五）–-React-Redux-基本使用" class="headerlink" title="React 入门学习（十五）– React-Redux 基本使用"></a>React 入门学习（十五）– React-Redux 基本使用</h2><h2 id="引言-1"><a href="#引言-1" class="headerlink" title="引言"></a>引言</h2><p>在前面我们学习了 Redux ，我们在写案例的时候，也发现了它存在着一些问题，例如组件无法状态无法公用，每一个状态组件都需要通过订阅来监视，状态更新会影响到全部组件更新，面对着这些问题，React 官方在 redux 基础上提出了 React-Redux 库</p>
<p>在前面的案例中，我们如果把 store 直接写在了 React 应用的顶层 props 中，各个子组件，就能访问到顶层 props</p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>顶层组件 store<span class="token operator">=</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>store<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>顶层组件<span class="token operator">/</span><span class="token operator">></span>
</code></pre>
<p>这就类似于 React-Redux</p>
<h2 id="容器组件和-UI-组件"><a href="#容器组件和-UI-组件" class="headerlink" title="容器组件和 UI 组件"></a>容器组件和 UI 组件</h2><ol>
<li>所有的 UI 组件都需要有一个容器组件包裹</li>
<li>容器组件来负责和 Redux 打交道，可以随意使用 Redux 的API</li>
<li>UI 组件无任何 Redux API</li>
<li>容器组件用于处理逻辑，UI 组件只会负责渲染和交互，不处理逻辑</li>
</ol>
<p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20210910094426268.png" alt="image-20210910094426268"></p>
<p>在我们的生产当中，我们可以直接将 UI 组件写在容器组件的代码文件当中，这样就无需多个文件</p>
<p>首先，我们在 src 目录下，创建一个 <code>containers</code> 文件夹，用于存放各种容器组件，在该文件夹内创建 <code>Count</code> 文件夹，即表示即将创建 Count 容器组件，再创建 <code>index.jsx</code> 编写代码</p>
<p>要实现容器组件和 UI 组件的连接，我们需要通过 <code>connect</code> 来实现</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 引入UI组件</span>
<span class="token keyword">import</span> CountUI <span class="token keyword">from</span> <span class="token string">'../../components/Count'</span>
<span class="token comment" spellcheck="true">// 引入 connect 连接UI组件</span>
<span class="token keyword">import</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>connect<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token comment" spellcheck="true">// 建立连接</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>CountUI<span class="token punctuation">)</span>
</code></pre>
<p>后面还会详细讲到</p>
<h2 id="Provider"><a href="#Provider" class="headerlink" title="Provider"></a>Provider</h2><p>由于我们的状态可能会被很多组件使用，所以 React-Redux 给我们提供了一个 Provider 组件，可以全局注入 redux 中的 store ，只需要把 Provider 注册在根部组件即可</p>
<p>例如，当以下组件都需要使用 store 时，我们需要这么做，但是这样徒增了工作量，很不便利</p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>Count store<span class="token operator">=</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>store<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/* 示例 */</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span>Demo1 store<span class="token operator">=</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>store<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span>Demo1 store<span class="token operator">=</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>store<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span>Demo1 store<span class="token operator">=</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>store<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span>Demo1 store<span class="token operator">=</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>store<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span>Demo1 store<span class="token operator">=</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>store<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">/</span><span class="token operator">></span>
</code></pre>
<p>我们可以这么做：在 src 目录下的 <code>index.js</code> 文件中，引入 <code>Provider</code> ，直接用 <code>Provider</code> 标签包裹 <code>App</code> 组件，将 <code>store</code> 写在 <code>Provider</code> 中即可</p>
<pre class=" language-js"><code class="language-js">ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>store<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">></span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>这样我们在 <code>App.jsx</code> 文件中，组件无需手写指定 <code>store</code> ，即可使用 <code>store</code> </p>
<h2 id="connect"><a href="#connect" class="headerlink" title="connect"></a>connect</h2><p>在前面我们看到的 react-redux 原理图时，我们会发现容器组件需要给 UI 组件传递状态和方法，并且是通过 <code>props</code> 来传递，看起来很简单。但是，我们会发现容器组件中似乎没有我们平常传递 <code>props</code> 的情形</p>
<p>这时候就需要继续研究一下容器组件中的唯一一个函数 <code>connect</code> </p>
<p>connect 方法是一个连接器，用于连接容器组件和 UI 组件，它第一次执行时，接收4个参数，这些参数都是<strong>可选的</strong>，它执行的执行的结果还是一个函数，第二次执行接收一个 UI 组件</p>
<p>第一次执行时的四个参数：<code>mapStateToProps</code> 、<code>mapDispatchToProps</code> 、<code>mergeProps</code>、<code>options</code></p>
<h3 id="mapStateToProps"><a href="#mapStateToProps" class="headerlink" title="mapStateToProps"></a>mapStateToProps</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> mapStateToProps <span class="token operator">=</span> state <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> count<span class="token punctuation">:</span> state <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
</code></pre>
<p>它接收  <code>state</code> 作为参数，并且返回一个对象，这个对象标识着 UI 组件的同名参数，</p>
<p>返回的对象中的 key 就作为传递给 UI 组件 props 的 key，value 就作为 props 的 value</p>
<p>如上面的代码，我们可以在 UI 组件中直接通过 props 来读取 <code>count</code> 值</p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>h1<span class="token operator">></span>当前求和为：<span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>count<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
</code></pre>
<p>这样我们就打通了 UI 组件和容器组件间的状态传递，那如何传递方法呢？</p>
<h3 id="mapDispatchToProps"><a href="#mapDispatchToProps" class="headerlink" title="mapDispatchToProps"></a>mapDispatchToProps</h3><p>connect 接受的第二个参数是 <code>mapDispatchToProps</code> 它是用于建立 UI 组件的参数到 <code>store.dispacth</code> 方法的映射</p>
<p>我们可以把参数写成对象形式，在这里面定义 action 执行的方法，例如 <code>jia</code> 执行什么函数，<code>jian</code> 执行什么函数？</p>
<p>我们都可以在这个参数中定义，如下定义了几个方法对应的操作函数</p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    jia<span class="token punctuation">:</span> createIncrementAction<span class="token punctuation">,</span>
    jian<span class="token punctuation">:</span> createDecrementAction<span class="token punctuation">,</span>
    jiaAsync<span class="token punctuation">:</span> createIncrementAsyncAction
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<p>写到这里其实 <code>connect</code> 已经比较完善了，但是你可以仔细想想 <code>redux</code> 的工作流程</p>
<p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20210909194900532.png" alt="image-20210909194900532"></p>
<p>似乎少了点什么，我们在这里调用了函数，创建了 <code>action</code> 对象，但是好像 <code>store</code> 并没有执行 <code>dispatch</code> ，那是不是断了呢？执行不了呢？</p>
<p>其实这里 <code>react-redux</code> 已经帮我们做了优化，当调用 <code>actionCreator</code> 的时候，会立即发送 <code>action</code> 给 <code>store</code> 而不用手动的 <code>dispatch</code></p>
<ul>
<li>自动调用 dispatch</li>
</ul>
<h2 id="完整开发"><a href="#完整开发" class="headerlink" title="完整开发"></a>完整开发</h2><p>首先我们在 <code>containers</code> 文件夹中，直接编写我们的容器组件，无需编写 UI 组件</p>
<p>先打 <code>rcc</code> 打出指定代码段，然后暴露出 <code>connect</code> 方法</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> connect <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
</code></pre>
<p>从 <code>action</code> 文件中暴露创建 <code>action</code> 的方法</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>createIncrementAction<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">from</span> <span class="token string">'../../redux/count_action'</span>
</code></pre>
<p>编写 UI 组件，简单写个 demo，绑定 props 和方法</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
        <span class="token operator">&lt;</span>h2<span class="token operator">></span>当前求和为：<span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>count<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>add<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">></span>点我加<span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p> 调用 <code>connect</code> 包装暴露 UI 组件</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>
    state <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> count<span class="token punctuation">:</span> state <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// 状态</span>
    <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> jia<span class="token punctuation">:</span> createIncrementAction <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 方法</span>
<span class="token punctuation">)</span><span class="token punctuation">(</span>Count<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>第一次执行的参数就直接传递 <code>state</code> 和一个指定 <code>action</code> 的对象</p>
<hr>
<blockquote>
<p>非常感谢您的阅读，欢迎提出你的意见，有什么问题欢迎指出，谢谢！🎈</p>
</blockquote>
<h2 id="React-入门学习（十六）–-数据共享"><a href="#React-入门学习（十六）–-数据共享" class="headerlink" title="React 入门学习（十六）– 数据共享"></a>React 入门学习（十六）– 数据共享</h2><h2 id="引言-2"><a href="#引言-2" class="headerlink" title="引言"></a>引言</h2><p>在写完了基本的 Redux 案例之后，我们可以尝试一些更实战性的操作，比如我们可以试试多组件间的状态传递，相互之间的交互</p>
<p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/react-redux-demo.gif" alt="react-redux-demo"></p>
<p>如上动图所示，我们想要实现上面的案例，采用纯 React 来实现是比较困难的，我们需要<strong>很多层的数据交换</strong>才能实现，但是我们如果采用 Redux 来实现会变得非常简单</p>
<p>因为 Redux <strong>打通了组件间的隔阂</strong>，我们可以自由的进行数据交换，所有存放在 <code>store</code> 中的数据都可以实现共享，那我们接下来看看如何实现的吧~</p>
<h2 id="1-编写-Person-组件"><a href="#1-编写-Person-组件" class="headerlink" title="1. 编写 Person 组件"></a>1. 编写 Person 组件</h2><blockquote>
<p>上面的 Count 组件，已经在前面几篇写过了，但是我没有记录详细的实现过程，只是做了一些小小的总结（我摸鱼了）</p>
</blockquote>
<p>不管如何，我们先来实现一个 Person 组件吧</p>
<p>首先我们需要在 <code>containers</code> 文件夹下编写 Person 组件的<strong>容器组件</strong></p>
<p>如何编写一个容器组件呢？（上一篇也讲过了）</p>
<p>首先我们需要编写 <code>index.jsx</code> 文件，在这个文件里面编写 Person 组件的 <strong>UI 组件</strong>，并使用 <code>connect</code> 函数将它包装，<strong>映射它的状态和方法</strong></p>
<h4 id="编写-UI-组件架构"><a href="#编写-UI-组件架构" class="headerlink" title="编写 UI 组件架构"></a><strong>编写 UI 组件架构</strong></h4><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span>h2<span class="token operator">></span>我是 Person 组件<span class="token punctuation">,</span>上方组件求和为<span class="token punctuation">:</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>countAll<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
    <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>c <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">this</span><span class="token punctuation">.</span>nameNode <span class="token operator">=</span> c<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> type<span class="token operator">=</span><span class="token string">"text"</span> placeholder<span class="token operator">=</span><span class="token string">"输入名字"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>c <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">this</span><span class="token punctuation">.</span>ageNode <span class="token operator">=</span> c<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> type<span class="token operator">=</span><span class="token string">"text"</span> placeholder<span class="token operator">=</span><span class="token string">"输入年龄"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>addPerson<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">></span>添加<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span>ul<span class="token operator">></span>
        <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>persons<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>p<span class="token punctuation">.</span>id<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>p<span class="token punctuation">.</span>name<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">--</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>p<span class="token punctuation">.</span>age<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
            <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
</code></pre>
<p>我们可以看到这里采用了 <code>ref</code> 来获取到当前事件触发的节点，并通过 <code>this.addPerson</code> 的方式给按钮绑定了一个点击事件</p>
<h4 id="编写点击事件回调"><a href="#编写点击事件回调" class="headerlink" title="编写点击事件回调"></a><strong>编写点击事件回调</strong></h4><pre class=" language-js"><code class="language-js">addPerson <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nameNode<span class="token punctuation">.</span>value
    <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ageNode<span class="token punctuation">.</span>value
    <span class="token keyword">const</span> personObj <span class="token operator">=</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> id<span class="token punctuation">:</span> <span class="token function">nanoid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> age <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>personObj<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>nameNode<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ageNode<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<p>在这里我们需要处理输入框中的数据，并且将这些数据用于创建一个 <code>action</code> 对象，传递给 <code>store</code> 进行状态的更新</p>
<p>在这里我们需要回顾的是，这里我们使用了一个 <code>nanoid</code> 库，这个库我们之前也有使用过</p>
<h5 id="下载，引入，暴露"><a href="#下载，引入，暴露" class="headerlink" title="下载，引入，暴露"></a><strong>下载，引入，暴露</strong></h5><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> nanoid <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">from</span> <span class="token string">'nanoid'</span>
</code></pre>
<p>暴露的 <code>nanoid</code> 是一个函数，我们每一次调用时，都会返回一个不重复的数，用于确保 <code>id</code> 的唯一性，同时在后面的 <code>map</code> 遍历的过程中，我们将 <code>id</code> 作为了 <code>key</code> 值，这样也确保了 <code>key</code> 的唯一性，关于 <code>key</code> 的作用，可以看看 <code>diffing</code> 算法的文章</p>
<h4 id="状态管理"><a href="#状态管理" class="headerlink" title="状态管理"></a><strong>状态管理</strong></h4><p>在这里我们需要非常熟练的采用 <code>this.props.add</code> 的方式来更新状态</p>
<p>那么它是如何实现状态更新的呢？我们来看看</p>
<p>在我们调用 <code>connect</code> 函数时，我们第一次调用时传入的第二个参数，就是用于传递方法的，我们传递了一个 <code>add</code> 方法</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>
    state <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> persons<span class="token punctuation">:</span> state<span class="token punctuation">.</span>person<span class="token punctuation">,</span> countAll<span class="token punctuation">:</span> state<span class="token punctuation">.</span>count <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//映射状态</span>
    <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> add<span class="token punctuation">:</span> createAddPersonAction <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token punctuation">)</span><span class="token punctuation">(</span>Person<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>它的原词是：<strong>mapDispatchToProps</strong></p>
<p>我的理解是，传入的东西会被映射映射成 <code>props</code> 对象下的方法，这也是我们能够在 <code>props</code> 下访问到 <code>add</code> 方法的原因</p>
<blockquote>
<p>对于这一块 <code>connect</code> ，我们必须要能够形成自己的理解，这里非常的重要，它实现了数据的交互，不至于一个组件，而是全部组件</p>
</blockquote>
<h4 id="我是如何理解的呢？"><a href="#我是如何理解的呢？" class="headerlink" title="我是如何理解的呢？"></a><strong>我是如何理解的呢？</strong></h4><blockquote>
<p>想象一个 store 仓库，在我们这个案例当中，Count 组件需要存放 count 值在 store 中，Person 组件需要存放新增用户对象在 store 中，我们要把这两个数据存放在一个对象当中。当某个组件需要使用 store 中的值时，可以通过 connect 中的两个参数来获取，例如这里我们需要使用到 Count 组件的值，可以通过 <code>.count</code> 来从 store 中取值。</p>
</blockquote>
<p>也就是说，所有的值都存放在 store 当中，通过点运算符来获取，所有的操作 store 的方法都需要通过 action 来实现。<strong>当前组件需要使用的数据都需要在 <code>connect</code> 中暴露</strong></p>
<h2 id="2-编写-reducer"><a href="#2-编写-reducer" class="headerlink" title="2. 编写 reducer"></a>2. 编写 reducer</h2><p>首先，我们需要明确 reducer 的作用，它是用来干什么的？</p>
<p><strong>根据操作类型来指定状态的更新</strong></p>
<p>也就是说当我们点击了<strong>添加按钮</strong>后，会将输入框中的数据整合成一个对象，作为当前 action 对象的 data 传递给 reducer</p>
<p>我们可以看看我们编写的 action 文件，和我们想的一样</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> ADD_PERSON <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">from</span> <span class="token string">"../constant"</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 创建一个人的action 对象</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> createAddPersonAction <span class="token operator">=</span> <span class="token punctuation">(</span>personObj<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
  type<span class="token punctuation">:</span> ADD_PERSON<span class="token punctuation">,</span>
  data<span class="token punctuation">:</span> personObj<span class="token punctuation">,</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>当 reducer 接收到 action 对象时，会对 type 进行判断</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">personReducer</span><span class="token punctuation">(</span>preState <span class="token operator">=</span> initState<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> type<span class="token punctuation">,</span> data <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token operator">=</span> action<span class="token punctuation">;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> ADD_PERSON<span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span><span class="token operator">...</span>preState<span class="token punctuation">]</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> preState
  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<p>一般都采用 <code>switch</code> 来编写</p>
<p><strong>这里有个值得注意的地方是</strong>，这个 <code>personReducer</code> 函数是一个纯函数，什么是纯函数呢？这个是高阶函数部分的知识了，纯<strong>函数是一个不改变参数的函数，也就是说，传入的参数是不能被改变的。</strong></p>
<p>为什么要提这个呢？在我们 return 时，有时候会想通过<strong>数组的 API</strong> 来在数组前面塞一个值，不也可以吗？</p>
<p>但是我们要采用 <code>unshirt</code> 方法，这个方法是会改变原数组的，也就是我们传入的参数会被改变，因此这样的方法是不可行的！</p>
<h2 id="3-打通数据共享"><a href="#3-打通数据共享" class="headerlink" title="3. 打通数据共享"></a>3. 打通数据共享</h2><p>写到这里，或许已经写完了，但是有些细节还是需要注意一下</p>
<p>采用 Redux 来进行组件的数据交互真的挺方便。</p>
<p>我们可以在 Count 组件中引入 Person 组件存在 store 中的状态。</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>state <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> count<span class="token punctuation">:</span> state<span class="token punctuation">.</span>count<span class="token punctuation">,</span> personNum<span class="token punctuation">:</span> state<span class="token punctuation">.</span>person<span class="token punctuation">.</span>length <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
       <span class="token operator">...</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token punctuation">)</span><span class="token punctuation">(</span>Count<span class="token punctuation">)</span>
</code></pre>
<p>在这里我们将 store 中的 person 数组的长度暴露出来这样 Count 组件就可以直接通过 props 来使用了</p>
<p>同样的我们也可以在 Person 组件中使用 Count 组件的值</p>
<p>从而实现了我们的这个 Demo</p>
<h2 id="4-最终优化"><a href="#4-最终优化" class="headerlink" title="4. 最终优化"></a>4. 最终优化</h2><ol>
<li>利用对象的简写方法，将键名和键值同名，从而只写一个名即可</li>
<li>合并 reducer ，我们可以将多个 reducer文件 写在一个 index 文件当中，需要采用 <code>combineReducers</code> 来合并</li>
</ol>
<h2 id="5-项目打包"><a href="#5-项目打包" class="headerlink" title="5. 项目打包"></a>5. 项目打包</h2><p>执行 <code>npm run build</code> 命令，即可打包项目，打包完成后，会生成一个 <code>build</code> 文件，这个文件我们需要部署到服务器上才能运行</p>
<p>我们可以放在自己的服务器上即可</p>
<p>但是我遇到了一个问题</p>
<p>打包后的文件路径少了一个 <code>.</code> 导致文件无法找到，报错无法执行，我通过手动添加的方式解决了，不知道还有没有什么其他方法解决</p>
<p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/react-redux-demo.gif" alt="react-redux-demo"></p>
<blockquote>
<p>也可以采用 <code>npm i serve -g</code> 安装，如何通过 serve ‘指定文件夹’ 来执行</p>
</blockquote>
<hr>
<blockquote>
<p>非常感谢您的阅读，欢迎提出你的意见，有什么问题欢迎指出，谢谢！🎈</p>
</blockquote>
<h2 id="React-入门学习（十七）–-React-扩展"><a href="#React-入门学习（十七）–-React-扩展" class="headerlink" title="React 入门学习（十七）– React 扩展"></a>React 入门学习（十七）– React 扩展</h2><h2 id="引言-3"><a href="#引言-3" class="headerlink" title="引言"></a>引言</h2><p>学到这里 React 已经学的差不多了，接下来就学习一些 React 扩展内容，可以帮助我们更好的开发和理解，这部分的知识还有很多的东西可以探寻，比如：网红 React-Hook，就是我们需要注意的地方，打了 100 多集的类式组件，出来一个 hooks ，现在用函数式组件偏多了………….</p>
<p>所以 Hooks 就需要我们深入的学习一下了，下面我们就一起来看看扩展部分有哪些内容吧</p>
<h2 id="1-setState"><a href="#1-setState" class="headerlink" title="1. setState"></a>1. setState</h2><h3 id="对象式-setState"><a href="#对象式-setState" class="headerlink" title="对象式 setState"></a>对象式 setState</h3><p>首先在我们以前的认知中，<code>setState</code> 是用来更新状态的，我们一般给它传递一个对象，就像这样</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    count<span class="token punctuation">:</span> count <span class="token operator">+</span> <span class="token number">1</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
</code></pre>
<p>这样每次更新都会让 <code>count</code> 的值加 1。这也是我们最常做的东西</p>
<p>这里我们做一个案例，点我加 1，一个按钮一个值，我要在控制台输出每次的 <code>count</code> 的值</p>
<p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/react-extension-demo1.gif" alt="react-extension-demo1"></p>
<p>那我们需要在控制台输出，要如何实现呢？</p>
<p>我们会考虑在 <code>setState</code> 更新之后 <code>log</code> 一下</p>
<pre class=" language-js"><code class="language-js">add <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> count <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        count<span class="token punctuation">:</span> count <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<p>因此可能会写出这样的代码，看起来很合理，在调用完 <code>setState</code> 之后，输出 <code>count</code> </p>
<p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/react-extension-demo1-2.gif" alt="react-extension-demo1-2"></p>
<p>我们发现显示的 <code>count</code> 和我们控制台输出的 <code>count</code> 值是不一样的</p>
<p>这是因为，我们调用的 <code>setState</code> 是同步事件，但是它的作用是让 React 去更新数据，而 React 不会立即的去更新数据，这是一个异步的任务，因此我们输出的 <code>count</code> 值会是状态更新之前的数据。“React <strong>状态更新是异步的</strong>”</p>
<p>那我们要如何实现同步呢？</p>
<p>其实在 <code>setState</code> 调用的第二个参数，我们可以接收一个函数，这个函数会在状态更新完毕并且界面更新之后调用，我们可以试试</p>
<pre class=" language-js"><code class="language-js">add <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> count <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        count<span class="token punctuation">:</span> count <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<p>我们将 <code>setState</code> 填上第二个参数，输出更新后的 <code>count</code> 值</p>
<p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/react-extension-demo1-3.gif" alt="react-extension-demo1-3"></p>
<p>这样我们就能成功的获取到最新的数据了，如果有这个需求我们可以在第二个参数输出噢~</p>
<h3 id="函数式-setState"><a href="#函数式-setState" class="headerlink" title="函数式 setState"></a>函数式 setState</h3><p>这种用法我也是第一次见，函数式的 <code>setState</code> 也是接收两个参数</p>
<p>第一个参数是 <code>updater</code>  ，它是一个能够返回 <code>stateChange</code> 对象的函数</p>
<p>第二个参数是一个回调函数，用于在状态更新完毕，界面也更新之后调用</p>
<p>与对象式 <code>setState</code> 不同的是，我们传递的第一个参数 <code>updater</code> 可以接收到2个参数 <code>state</code> 和 <code>props</code> </p>
<p>我们尝试一下</p>
<pre class=" language-js"><code class="language-js">add <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> count<span class="token punctuation">:</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/react-extension-demo2-1.gif" alt="react-extension-demo2-1"></p>
<p>我们也成功的实现了</p>
<p>我们在第一个参数中传入了一个函数，这个函数可以接收到 <code>state</code> ，我们通过更新 <code>state</code> 中的 <code>count</code> 值，来驱动页面的更新</p>
<p>利用函数式 <code>setState</code> 的优势还是很不错的，可以直接获得 <code>state</code> 和 <code>props</code> </p>
<blockquote>
<p>可以理解为对象式的 <code>setState</code> 是函数式 <code>setState</code> 的语法糖</p>
</blockquote>
<h2 id="2-LazyLoad"><a href="#2-LazyLoad" class="headerlink" title="2. LazyLoad"></a>2. LazyLoad</h2><p>懒加载在 React 中用的最多的就是路由组件了，页面刷新时，所有的页面都会重新加载，这并不是我们想要的，我们想要实现点击哪个路由链接再加载即可，这样避免了不必要的加载</p>
<p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/react-extension-demo2-2.gif" alt="react-extension-demo2-2"></p>
<p>我们可以发现，我们页面一加载时，所有的路由组件都会被加载</p>
<p>如果我们有 100 个路由组件，但是用户只点击了几个，这就会有很大的消耗，因此我们需要做懒加载处理，<strong>我们点击哪个时，才去加载哪一个</strong></p>
<p>首先我们需要从 <code>react</code> 库中暴露一个 <code>lazy</code> 函数</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> Component <span class="token punctuation">,</span>lazy<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
</code></pre>
<p>然后我们需要更改引入组件的方式</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> Home <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./Home'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> About <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./About'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>采用 <code>lazy</code> 函数包裹</p>
<p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20210911114307684.png" alt="image-20210911114307684"></p>
<p>我们会遇到这样的错误，提示我们用一个标签包裹</p>
<p>这里是因为，当我们网速慢的时候，路由组件就会有可能加载不出来，页面就会白屏，它需要我们来指定一个路由组件加载的东西，相对于 loading</p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>h1<span class="token operator">></span>loading<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/home"</span> component<span class="token operator">=</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>Home<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span>
    <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/about"</span> component<span class="token operator">=</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>About<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">></span>
</code></pre>
<blockquote>
<p>在做这个案例的时候，一定不要设置重定向的东西，所有的路由我们要点击再加载</p>
</blockquote>
<p>初次登录页面的时候</p>
<p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20210911115542647.png" alt="image-20210911115542647"></p>
<p>注意噢，这些文件都不是路由组件，当我们点击了对应组件之后才会加载</p>
<p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/react-extension-lazyload-2.gif" alt="react-extension-lazyload-2"></p>
<p>从上图我们可以看出，每次点击时，才会去请求 <code>chunk</code> 文件</p>
<p>那我们更改写的 <code>fallback</code> 有什么用呢？它会在页面还没有加载出来的时候显示</p>
<p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/react-extension-lazyload-3.gif" alt="react-extension-lazyload-3"></p>
<blockquote>
<p>注意：因为 loading 是作为一个兜底的存在，因此 loading 是 必须提前引入的，不能懒加载</p>
</blockquote>
<h2 id="3-Hooks"><a href="#3-Hooks" class="headerlink" title="3. Hooks"></a>3. Hooks</h2><h3 id="useState"><a href="#useState" class="headerlink" title="useState"></a>useState</h3><p><code>hooks</code> 解决了函数式组件和类式组件的差异，让函数式组件拥有了类式组件所拥有的 <code>state</code> ，同时新增了一些 API ，让函数式组件，变得更加的灵活</p>
<p>首先我们需要明确一点，函数式组件<strong>没有</strong>自己的 <code>this</code></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span>h2<span class="token operator">></span>当前求和为：<span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>count<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>add<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">></span>点我加<span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Demo
</code></pre>
<p>利用函数式组件完成的 <strong>点我加1</strong> 案例</p>
<p>这里利用了一个 Hook ：<code>useState</code> </p>
<p>它让函数式组件能够维护自己的 <code>state</code> ，它<strong>接收一个参数</strong>，作为<strong>初始化</strong> <code>state</code> 的值，赋值给 <code>count</code>，因此 <code>useState</code> 的初始值只有<strong>第一次有效</strong>，它所映射出的两个变量 <code>count</code> 和 <code>setCount</code> 我们可以理解为 <code>setState</code> 来使用</p>
<blockquote>
<p><strong>useState 能够返回一个数组，第一个元素是 state ，第二个是更新 state 的函数</strong></p>
</blockquote>
<p>我们先看看控制台输出的什么</p>
<p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20210911123011304.png" alt="image-20210911123011304"></p>
<p><code>count</code> 是初始化的值，而 <code>setCount</code> 就像是一个 <code>action</code> 对象驱动状态更新</p>
<p>我们可以通过 <code>setCount</code> 来更新 <code>count</code> 的值</p>
<pre class=" language-js"><code class="language-js"><span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="useEffect"><a href="#useEffect" class="headerlink" title="useEffect"></a>useEffect</h3><p> 在类式组件中，提供了一些声明周期钩子给我们使用，我们可以在组件的特殊时期执行特定的事情，例如 <code>componentDidMount</code> ，能够在组件挂载完成后执行一些东西</p>
<p>在函数式组件中也可以实现，它采用的是 <code>effectHook</code> ，它的语法更加的简单，同时融合了 <code>componentDidUpdata</code> 生命周期，极大的方便了我们的开发</p>
<pre class=" language-js"><code class="language-js">React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'被调用了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
</code></pre>
<p>由于函数的特性，我们可以在函数中随意的编写函数，这里我们调用了 <code>useEffect</code> 函数，这个函数有多个功能</p>
<p>当我们像上面代码那样使用时，它相当于 <code>componentDidUpdata</code> 和 <code>componentDidMount</code> 一同使用，也就是在<strong>组件挂载和组件更新</strong>的时候都会调用这个函数</p>
<p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/react-extension-hook-1.gif" alt="react-extension-hook-1"></p>
<p>它还可以接收第二个参数，这个参数表示它要<strong>监测的数据</strong>，也就是他要监视哪个数据的变化</p>
<p>当我们不需要监听任何状态变化的时候，我们可以就<strong>传递一个空数组</strong>，这样它就能当作 <code>componentMidMount</code> 来使用</p>
<pre class=" language-js"><code class="language-js">React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'被调用了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<p>这样我们只有在组件第一次挂载的时候触发</p>
<p>当然当页面中有多个数据源时，我们也可以选择个别的数据进行监测以达到我们想要的效果</p>
<pre class=" language-js"><code class="language-js">React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'被调用了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<p>这样，我们就只<strong>监视 count 数据的变化</strong></p>
<p>当我们想要在卸载一个组件之前进行一些<strong>清除定时器</strong>的操作，在类式组件中，我们会调用生命周期钩子 <code>componentDidUnmount</code> 来实现，在函数式组件中，我们的写法更为简单，我们直接在 <code>useEffect</code> 的第一个参数的返回值中实现即可<br>也就是说，第一个参数的函数体相当于 <code>componentDidMount</code> 返回体相当于 <code>componentDidUnmount</code> ，这样我们就能实现在组件即将被卸载时输出一些东西了</p>
<p><strong>实现卸载</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    ReactDOM<span class="token punctuation">.</span><span class="token function">unmountComponentAtNode</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>卸载前输出</strong></p>
<pre class=" language-js"><code class="language-js">React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'被调用了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我要被卸载了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/react-extension-hook-2.gif" alt="react-extension-hook-2"></p>
<p>实现了在组件即将被卸载的时候输出</p>
<p>因此 <code>useEffect</code> 相当于三个生命周期钩子，<code>componentDidMount</code> 、<code>componentDidUpdata</code> 、<code>componentDidUnmount</code></p>
<h3 id="useRef"><a href="#useRef" class="headerlink" title="useRef"></a>useRef</h3><p>当我们想要获取组件内的信息时，在类式组件中，我们会采用 <code>ref</code> 的方式来获取。在函数式组件中，我们可以采用也可以采用 <code>ref</code> 但是，我们需要采用 <code>useRef</code> 函数来创建一个 ref 容器，这和 <code>createRef</code> 很类似。</p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> ref<span class="token operator">=</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>myRef<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token operator">/</span><span class="token operator">></span>
</code></pre>
<p>获取 ref 值</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>myRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<p>即可成功的获取到 input 框中的值</p>
<h2 id="4-Fragment"><a href="#4-Fragment" class="headerlink" title="4. Fragment"></a>4. Fragment</h2><p>我们编写组件的时候每次都需要采用一个 <code>div</code> 标签包裹，才能让它正常的编译，但是这样会引发什么问题呢？我们打开控制台看看它的层级</p>
<p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20210911151643934.png" alt="image-20210911151643934"></p>
<p>它包裹了几层无意义的 div 标签，我们可以采用 <code>Fragment</code> 来解决这个问题</p>
<p>首先，我们需要从 react 中暴露出 <code>Fragment</code> ，将我们所写的内容采用 <code>Fragment</code> 标签进行包裹，当它解析到 <code>Fragment</code> 标签的时候，就会把它去掉</p>
<p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20210911152037120.png" alt="image-20210911152037120"></p>
<p>这样我们的内容就直接挂在了 <code>root</code> 标签下</p>
<blockquote>
<p>同时采用空标签，也能实现，但是它不能接收任何值，而 <code>Fragment</code> 能够接收 1 个值<code>key</code> </p>
</blockquote>
<h2 id="5-Context"><a href="#5-Context" class="headerlink" title="5. Context"></a>5. Context</h2><h4 id="仅适用于类式组件"><a href="#仅适用于类式组件" class="headerlink" title="仅适用于类式组件"></a>仅适用于类式组件</h4><p>当我们想要给子类的子类传递数据时，前面我们讲过了 redux 的做法，这里介绍的 Context 我觉得也类似于 Redux</p>
<p>首先我们需要引入一个 <code>MyContext</code> 组件，我们需要引用<code>MyContext</code> 下的 <code>Provider</code> </p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> MyContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> Provider <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token operator">=</span> MyContext<span class="token punctuation">;</span>
</code></pre>
<p>用 <code>Provider</code> 标签包裹 A组件内的 B 组件，并通过 <code>value</code> 值，将数据传递给子组件，这样以 A 组件为父代组件的所有子组件都能够接受到数据</p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>Provider value<span class="token operator">=</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> username<span class="token punctuation">,</span> age <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>B <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">></span>
</code></pre>
<p>但是我们需要在使用数据的组件中引入 <code>MyContext</code> </p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">static</span> contextType <span class="token operator">=</span> MyContext<span class="token punctuation">;</span>
</code></pre>
<p>在使用时，直接从 <code>this.context</code> 上取值即可</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>username<span class="token punctuation">,</span>age<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context
</code></pre>
<h4 id="适用于函数和类式组件"><a href="#适用于函数和类式组件" class="headerlink" title="适用于函数和类式组件"></a>适用于函数和类式组件</h4><p>由于函数式组件没有自己 <code>this</code> ，所以我们不能通过 <code>this.context</code> 来获取数据</p>
<p>这里我们需要从 <code>Context</code> 身上暴露出一个 <code>Consumer</code></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> Provider <span class="token punctuation">,</span>Consumer<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token operator">=</span> MyContext<span class="token punctuation">;</span>
</code></pre>
<p>然后通过 <code>value</code> 取值即可</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>h3<span class="token operator">></span>我是C组件，我从A接收到的数据 <span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
      <span class="token operator">&lt;</span>Consumer<span class="token operator">></span>
        <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`$&amp;#123;value.username&amp;#125;,年龄是$&amp;#123;value.age&amp;#125;`</span></span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Consumer<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20210911161103300.png" alt="image-20210911161103300"></p>
<blockquote>
<p>因此想要在函数式组件中使用，需要引入 <code>Consumer</code></p>
</blockquote>
<h2 id="6-PureComponent"><a href="#6-PureComponent" class="headerlink" title="6. PureComponent"></a>6. PureComponent</h2><p>在我们之前一直写的代码中，我们一直使用的<code>Component</code> 是有问题存在的</p>
<ol>
<li>只要执行 <code>setState</code> ，即使不改变状态数据，组件也会调用 <code>render</code></li>
<li>当前组件状态更新，也会引起子组件 <code>render</code></li>
</ol>
<p>而我们想要的是只有组件的 <code>state</code> 或者 <code>props</code> 数据发生改变的时候，再调用 <code>render</code></p>
<p>我们可以采用重写 <code>shouldComponentUpdate</code> 的方法，但是这个方法不能根治这个问题，当状态很多时，我们没有办法增加判断</p>
<p>我们可以采用 <code>PureComponent</code> </p>
<p>我们可以从 <code>react</code> 身上暴露出 <code>PureComponent</code> 而不使用 <code>Component</code> </p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> PureComponent <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
</code></pre>
<p>就这~听了半天结果就只一个 <code>PureComponent</code> </p>
<p><code>PureComponent</code> 会对比当前对象和下一个状态的 <code>prop</code> 和 <code>state</code> ，而这个比较属于浅比较，比较基本数据类型是否相同，而对于引用数据类型，<strong>比较的是它的引用地址是否相同，这个比较与内容无关</strong></p>
<h2 id="7-render-props"><a href="#7-render-props" class="headerlink" title="7. render props"></a>7. render props</h2><p>采用 render props 技术，我们可以像组件内部动态传入带有内容的结构</p>
<blockquote>
<p>当我们在一个组件标签中填写内容时，这个内容会被定义为 children props，我们可以通过 <code>this.props.children</code> 来获取</p>
</blockquote>
<p>例如：</p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>A<span class="token operator">></span>hello<span class="token operator">&lt;</span><span class="token operator">/</span>A<span class="token operator">></span>
</code></pre>
<p>这个 hello 我们就可以通过 children 来获取</p>
<p>而我们所说的 render props 就是在组件标签中传入一个 render 方法，又因为属于 props ，因而被叫做了 render props</p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>A render<span class="token operator">=</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&lt;</span>C name<span class="token operator">=</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>name<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token operator">/</span><span class="token operator">></span>
</code></pre>
<p>你可以把 <code>render</code> 看作是 <code>props</code>，只是它有特殊作用，当然它也可以用其他名字来命名</p>
<p>在上面的代码中，我们需要在 A 组件中预留出 C 组件渲染的位置 在需要的位置上加上<code>&#123;this.props.render(name)&#125;</code></p>
<p>那我们在 C 组件中，如何接收 A 组件传递的 <code>name</code> 值呢？通过 <code>this.props.name</code> 的方式</p>
<h2 id="8-ErrorBoundary"><a href="#8-ErrorBoundary" class="headerlink" title="8. ErrorBoundary"></a>8. ErrorBoundary</h2><p>当不可控因素导致数据不正常时，我们不能直接将报错页面呈现在用户的面前，由于我们没有办法给每一个组件、每一个文件添加判断，来确保正常运行，这样很不现实，因此我们要用到<strong>错误边界</strong>技术</p>
<p><strong>错误边界就是让这块组件报错的影响降到最小，不要影响到其他组件或者全局的正常运行</strong></p>
<blockquote>
<p>例如 A 组件报错了，我们可以在 A 组件内添加一小段的提示，并把错误控制在 A 组件内，不影响其他组件</p>
</blockquote>
<ul>
<li>我们要对容易出错的组件的父组件做手脚，而不是组件本身</li>
</ul>
<p>我们在父组件中通过 <code> getDerivedStateFromError</code> 来配置<strong>子组件</strong>出错时的处理函数</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">static</span> <span class="token function">getDerivedStateFromError</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> hasError<span class="token punctuation">:</span> error <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<p>我们可以将 <code>hasError</code> 配置到状态当中，当 <code>hasError</code> 状态改变成 <code>error</code> 时，表明有错误发生，我们需要在组件中通过判断 <code>hasError</code> 值，来指定是否显示子组件</p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasError <span class="token operator">?</span> <span class="token operator">&lt;</span>h2<span class="token operator">></span>出错啦<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span> <span class="token punctuation">:</span> <span class="token operator">&lt;</span>Child <span class="token operator">/</span><span class="token operator">></span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p>在服务器中启动，才能正常看到效果</p>
</blockquote>
<p>可以在 <code>componentDidCatch</code> 中统计错误次数，通知编码人员进行 bug 解决</p>
<h2 id="9-组件通信方式总结"><a href="#9-组件通信方式总结" class="headerlink" title="9. 组件通信方式总结"></a>9. 组件通信方式总结</h2><ol>
<li>props<ul>
<li>children props</li>
<li>render props</li>
</ul>
</li>
<li>消息发布订阅<ul>
<li>利用 pubsub 库来实现</li>
</ul>
</li>
<li>集中式状态管理<ul>
<li>redux</li>
</ul>
</li>
<li>conText<ul>
<li>生成者-消费者</li>
</ul>
</li>
</ol>
<p><strong>选择方式</strong></p>
<p>父子组件采用：<code>props</code></p>
<p>兄弟组件采用：消息的发布订阅、redux</p>
<p>祖孙组件：消息发布订阅、redux、context</p>
<h2 id="React核心-–-React-Hooks"><a href="#React核心-–-React-Hooks" class="headerlink" title="React核心 – React-Hooks"></a>React核心 – React-Hooks</h2><h2 id="hooks-存在的意义"><a href="#hooks-存在的意义" class="headerlink" title="hooks 存在的意义"></a>hooks 存在的意义</h2><ol>
<li><p>hooks 之间的状态是独立的，有自己独立的上下文，不会出现混淆状态的情况</p>
</li>
<li><p>让函数有了状态管理</p>
</li>
<li><p>解决了 组件树不直观、类组件难维护、逻辑不易复用的问题</p>
</li>
<li><p>避免函数重复执行的副作用</p>
</li>
</ol>
<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><ol>
<li>利用 hooks 取代生命周期函数</li>
<li>让组件有了状态</li>
<li>组件辅助函数</li>
<li>处理发送请求</li>
<li>存取数据</li>
<li>做好性能优化</li>
</ol>
<h2 id="hooks-API"><a href="#hooks-API" class="headerlink" title="hooks API"></a>hooks API</h2><p>从 <code>react</code> 中引入</p>
<h3 id="1-useState"><a href="#1-useState" class="headerlink" title="1. useState"></a>1. useState</h3><p>给函数组件添加状态</p>
<ul>
<li>初始化以及更新组件状态</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre>
<p>接收一个参数作为初始值，返回一个数组：第一个是状态变量，第二个是修改变量的函数</p>
<h3 id="2-useEffect"><a href="#2-useEffect" class="headerlink" title="2. useEffect"></a>2. useEffect</h3><p>副作用 hooks</p>
<ul>
<li>给没有生命周期的组件，添加结束渲染的信号</li>
</ul>
<p>注意：</p>
<ul>
<li>render 之后执行的 hooks</li>
</ul>
<p>第一个参数接收一个函数，在组件更新的时候执行</p>
<p>第二个参数接收一个数组，用来表示需要追踪的变量，依赖列表，只有依赖更新的时候才会更新内容</p>
<p>第一个参数的返回值，返回一个函数，在 <code>useEffect</code> 执行之前，都会先执行里面返回的函数</p>
<p>一般用于添加销毁事件，这样就能保证只添加一个</p>
<pre class=" language-js"><code class="language-js">React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'被调用了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我要被卸载了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<p>打印</p>
<p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20210914172936843.png" alt="image-20210914172936843"></p>
<h3 id="3-useLayoutEffect"><a href="#3-useLayoutEffect" class="headerlink" title="3. useLayoutEffect"></a>3. useLayoutEffect</h3><p>和 <code>useEffect</code> 很类似</p>
<p>它的作用是：在 DOM 更新完成之后执行某个操作</p>
<p>注意：</p>
<ul>
<li>有 DOM 操作的副作用 hooks</li>
<li>在 DOM 更新之后执行</li>
</ul>
<blockquote>
<p>执行时机在 <code>useEffect</code> 之前，其他都和 <code>useEffect</code> 都相同</p>
</blockquote>
<p><code>useEffect</code> 执行时机在 <strong>render 之后</strong></p>
<p><code>useLayoutEffect</code> 执行时机在 <strong>DOM 更新之后</strong></p>
<h3 id="4-useMemo"><a href="#4-useMemo" class="headerlink" title="4. useMemo"></a>4. useMemo</h3><p>作用：让组件中的函数跟随状态更新</p>
<p>注意：优化函数组件中的功能函数</p>
<p><strong>为了避免由于其他状态更新导致的当前函数的被迫执行</strong></p>
<p>第一个参数接收一个函数，第二个参数为数组的依赖列表，返回一个值</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> getDoubleNum <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ddd'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator">*</span> num
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>num<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<h4 id="5-useCallback"><a href="#5-useCallback" class="headerlink" title="5. useCallback"></a>5. useCallback</h4><p>作用：跟随状态更新执行</p>
<p>注意：</p>
<ul>
<li>只有依赖项改变时才执行</li>
<li><code>useMemo( () =&gt; fn, deps)</code> 相当于 <code>useCallback(fn, deps)</code></li>
</ul>
<p>不同点：</p>
<ol>
<li><code>useCallback</code> <strong>返回的是一个函数，不再是值</strong></li>
<li><code>useCallback</code> 缓存的是一个函数，<code>useMemo</code> 缓存的是一个值，<strong>如果依赖不更新，返回的永远是缓存的那个函数</strong></li>
<li>给子组件中传递  <code>props</code>  的时候，如果当前组件不更新，不会触发子组件的重新渲染</li>
</ol>
<h3 id="6-useRef"><a href="#6-useRef" class="headerlink" title="6. useRef"></a>6. useRef</h3><p>作用：长久保存数据</p>
<p>注意事项：</p>
<ul>
<li>返回一个子元素索引，这个索引在整个生命周期中保持不变</li>
<li>对象发生改变时，不通知，属性变更不重新渲染</li>
</ul>
<ol>
<li>保存一个值，在整个生命周期中维持不变</li>
<li>重新赋值 <code>ref.current</code> 不会触发重新渲染</li>
<li>相当于<strong>创建一个额外的容器来存储数据</strong>，我们可以在外部拿到这个值</li>
</ol>
<p>当我们通过正常的方式去获取计时器的 <code>id</code> 是无法获取的，需要通过 <code>ref</code> </p>
<pre class=" language-js"><code class="language-js"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    ref<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token function">setNum</span><span class="token punctuation">(</span>num <span class="token operator">=</span><span class="token operator">></span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'到十了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">clearInterval</span><span class="token punctuation">(</span>ref<span class="token punctuation">.</span>current<span class="token punctuation">)</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>num<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="7-useContext"><a href="#7-useContext" class="headerlink" title="7. useContext"></a>7. useContext</h3><p>作用：带着子组件渲染</p>
<p>注意：</p>
<ul>
<li>上层数据发生改变，肯定会触发重新渲染</li>
</ul>
<ol>
<li>我们需要引入 <code>useContext</code> 和 <code>createContext</code> 两个内容</li>
<li>通过 <code>createContext</code> 创建一个 <code>Context</code> 句柄</li>
<li>通过 <code>Provider</code> 确定数据共享范围</li>
<li>通过 <code>value</code> 来分发数据</li>
<li>在子组件中，通过 <code>useContext</code> 来获取数据</li>
</ol>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> useContext<span class="token punctuation">,</span> createContext <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">const</span> Context <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Hook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>num<span class="token punctuation">,</span> setNum<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>h1<span class="token operator">></span>
            这是一个函数组件 <span class="token operator">-</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>num<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 确定范围</span>
            <span class="token operator">&lt;</span>Context<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>num<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>Item1 num<span class="token operator">=</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>num<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token operator">/</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>Item2 num<span class="token operator">=</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>num<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token operator">/</span><span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>Context<span class="token punctuation">.</span>Provider<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
    <span class="token punctuation">)</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">Item1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> num <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>Context<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>子组件<span class="token number">1</span>  <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>num<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">Item2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> num <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>Context<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>子组件<span class="token number">2</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>num<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="8-useReducer"><a href="#8-useReducer" class="headerlink" title="8. useReducer"></a>8. useReducer</h3><p>作用：去其他地方借资源</p>
<p>注意：函数组件的 Redux 的操作</p>
<ol>
<li>创建数据仓库 <code>store</code> 和管理者 <code>reducer</code></li>
<li>通过 <code>useReducer(store,dispatch)</code> 来获取 <code>state</code> 和 <code>dispatch</code></li>
</ol>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    num<span class="token punctuation">:</span> <span class="token number">10</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">""</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> store<span class="token punctuation">)</span>
</code></pre>
<p>通过 <code>dispatch</code> 去派发 <code>action</code></p>
<h3 id="9-自定义-hooks"><a href="#9-自定义-hooks" class="headerlink" title="9. 自定义 hooks"></a>9. 自定义 hooks</h3><p>放在 <code>utils</code> 文件夹中，以 <code>use</code> 开头命名</p>
<p>例如：模拟数据请求的 Hooks</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> useState<span class="token punctuation">,</span> useEffect <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">useLoadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>num<span class="token punctuation">,</span> setNum<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
      <span class="token function">setNum</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>num<span class="token punctuation">,</span> setNum<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> useLoadData<span class="token punctuation">;</span>
</code></pre>
<p>减少代码耦合</p>
<p>我们希望 reducer 能让每个组件来使用，我们自己写一个 hooks</p>
<p>自定义一个自己的 LocalReducer</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> useReducer <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> num<span class="token punctuation">:</span> <span class="token number">1210</span> <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">"num"</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> num<span class="token punctuation">:</span> action<span class="token punctuation">.</span>num <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> <span class="token operator">...</span>state <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">useLocalReducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> store<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> useLocalReducer<span class="token punctuation">;</span>
</code></pre>
<ol>
<li>引入 react 和自己需要的 hook</li>
<li>创建自己的hook函数</li>
<li>返回一个数组，数组中第一个内容是数据，第二个是修改数据的函数</li>
<li>暴露自定义 hook 函数出去</li>
<li>引入自己的业务组件</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://zyydgrbk.top">邹阳</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://zyydgrbk.top/2023/08/16/react-xue-xi-er/">http://zyydgrbk.top/2023/08/16/react-xue-xi-er/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://zyydgrbk.top" target="_blank">邹阳 の 博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%89%8D%E7%AB%AF/">前端</a></div><div class="post_share"><div class="social-share" data-image="https://zyydgrbk.oss-cn-chengdu.aliyuncs.com/images/0128be58d20fc3a801219c77e6ff8e.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/08/17/react-jiao-shou-jia-pei-zhi-dai-li-zong-jie/" title="react脚手架配置代理总结"><img class="cover" src="https://zyydgrbk.oss-cn-chengdu.aliyuncs.com/images/Snipaste_2023-08-17_17-09-32.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">react脚手架配置代理总结</div></div></a></div><div class="next-post pull-right"><a href="/2023/08/16/react-xue-xi/" title="react学习"><img class="cover" src="https://zyydgrbk.oss-cn-chengdu.aliyuncs.com/images/01d59958d20fd2a801219c77f1d73b.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">react学习</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/08/10/http-jie-kou-ping-tai-kai-fa/" title="http接口平台开发"><img class="cover" src="https://zyydgrbk.oss-cn-chengdu.aliyuncs.com/images/0121d458d20fb3a801219c77ae2613.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">http接口平台开发</div></div></a></div><div><a href="/2023/09/13/js-shen-ru-ife-baidu-com/" title="js深入-ife.baidu.com"><img class="cover" src="https://zyydgrbk.oss-cn-chengdu.aliyuncs.com/images/Snipaste_2023-08-17_17-10-46.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-13</div><div class="title">js深入-ife.baidu.com</div></div></a></div><div><a href="/2023/09/02/nodejs/" title="nodejs"><img class="cover" src="https://zyydgrbk.oss-cn-chengdu.aliyuncs.com/images/Snipaste_2023-08-17_17-10-26.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-02</div><div class="title">nodejs</div></div></a></div><div><a href="/2023/08/17/react-jiao-shou-jia-pei-zhi-dai-li-zong-jie/" title="react脚手架配置代理总结"><img class="cover" src="https://zyydgrbk.oss-cn-chengdu.aliyuncs.com/images/Snipaste_2023-08-17_17-09-32.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-17</div><div class="title">react脚手架配置代理总结</div></div></a></div><div><a href="/2023/08/17/xie-lian-shou-xiang-mu-shi-yu-jian-de-wen-ti/" title="写练手项目时遇见的问题"><img class="cover" src="https://zyydgrbk.oss-cn-chengdu.aliyuncs.com/images/Snipaste_2023-08-17_17-09-45.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-17</div><div class="title">写练手项目时遇见的问题</div></div></a></div><div><a href="/2023/09/26/hou-duan-wen-jian-shang-chuan/" title="后端文件上传"><img class="cover" src="https://zyydgrbk.oss-cn-chengdu.aliyuncs.com/images/Snipaste_2023-09-26_19-44-45.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-26</div><div class="title">后端文件上传</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://zyydgrbk.oss-cn-chengdu.aliyuncs.com/images/nobackground.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">邹阳</div><div class="author-info__description">Being happy is a duty!</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">70</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/"><i class="fab fa-github"></i><span>My github</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/" target="_blank" title="Github"><i class="fab fa-github" style="color: #hdhfbb;"></i></a><a class="social-icon" href="mailto:zouyang159536@163.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #000000;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#React-%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0%EF%BC%88%E5%8D%81%E5%9B%9B%EF%BC%89%E2%80%93-redux-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">React 入门学习（十四）– redux 基本使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E8%A8%80"><span class="toc-number">2.</span> <span class="toc-text">引言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%BD%BF%E7%94%A8-Redux-%EF%BC%9F"><span class="toc-number">3.</span> <span class="toc-text">1. 什么情况使用 Redux ？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Redux-%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">4.</span> <span class="toc-text">2. Redux 的工作流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Redux-%E4%B8%89%E4%B8%AA%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">5.</span> <span class="toc-text">3. Redux 三个核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-store"><span class="toc-number">5.0.1.</span> <span class="toc-text">1. store</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-action"><span class="toc-number">5.0.2.</span> <span class="toc-text">2. action</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-reducer"><span class="toc-number">5.0.3.</span> <span class="toc-text">3. reducer</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%88%9B%E5%BB%BA-constant-%E6%96%87%E4%BB%B6"><span class="toc-number">6.</span> <span class="toc-text">4. 创建 constant 文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%AE%9E%E7%8E%B0%E5%BC%82%E6%AD%A5-action"><span class="toc-number">7.</span> <span class="toc-text">5. 实现异步 action</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-Redux-%E4%B8%89%E5%A4%A7%E5%8E%9F%E5%88%99"><span class="toc-number">8.</span> <span class="toc-text">6. Redux 三大原则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8E%9F%E5%88%99"><span class="toc-number">8.1.</span> <span class="toc-text">第一个原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E4%B8%AA%E5%8E%9F%E5%88%99"><span class="toc-number">8.2.</span> <span class="toc-text">第二个原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E4%B8%AA%E5%8E%9F%E5%88%99"><span class="toc-number">8.3.</span> <span class="toc-text">第三个原则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">9.</span> <span class="toc-text">参考资料</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#React-%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0%EF%BC%88%E5%8D%81%E4%BA%94%EF%BC%89%E2%80%93-React-Redux-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">10.</span> <span class="toc-text">React 入门学习（十五）– React-Redux 基本使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E8%A8%80-1"><span class="toc-number">11.</span> <span class="toc-text">引言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E7%BB%84%E4%BB%B6%E5%92%8C-UI-%E7%BB%84%E4%BB%B6"><span class="toc-number">12.</span> <span class="toc-text">容器组件和 UI 组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Provider"><span class="toc-number">13.</span> <span class="toc-text">Provider</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#connect"><span class="toc-number">14.</span> <span class="toc-text">connect</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mapStateToProps"><span class="toc-number">14.1.</span> <span class="toc-text">mapStateToProps</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mapDispatchToProps"><span class="toc-number">14.2.</span> <span class="toc-text">mapDispatchToProps</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E5%BC%80%E5%8F%91"><span class="toc-number">15.</span> <span class="toc-text">完整开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#React-%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0%EF%BC%88%E5%8D%81%E5%85%AD%EF%BC%89%E2%80%93-%E6%95%B0%E6%8D%AE%E5%85%B1%E4%BA%AB"><span class="toc-number">16.</span> <span class="toc-text">React 入门学习（十六）– 数据共享</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E8%A8%80-2"><span class="toc-number">17.</span> <span class="toc-text">引言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%BC%96%E5%86%99-Person-%E7%BB%84%E4%BB%B6"><span class="toc-number">18.</span> <span class="toc-text">1. 编写 Person 组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99-UI-%E7%BB%84%E4%BB%B6%E6%9E%B6%E6%9E%84"><span class="toc-number">18.0.1.</span> <span class="toc-text">编写 UI 组件架构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E7%82%B9%E5%87%BB%E4%BA%8B%E4%BB%B6%E5%9B%9E%E8%B0%83"><span class="toc-number">18.0.2.</span> <span class="toc-text">编写点击事件回调</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%EF%BC%8C%E5%BC%95%E5%85%A5%EF%BC%8C%E6%9A%B4%E9%9C%B2"><span class="toc-number">18.0.2.1.</span> <span class="toc-text">下载，引入，暴露</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86"><span class="toc-number">18.0.3.</span> <span class="toc-text">状态管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%88%91%E6%98%AF%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E7%9A%84%E5%91%A2%EF%BC%9F"><span class="toc-number">18.0.4.</span> <span class="toc-text">我是如何理解的呢？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E7%BC%96%E5%86%99-reducer"><span class="toc-number">19.</span> <span class="toc-text">2. 编写 reducer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%89%93%E9%80%9A%E6%95%B0%E6%8D%AE%E5%85%B1%E4%BA%AB"><span class="toc-number">20.</span> <span class="toc-text">3. 打通数据共享</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%9C%80%E7%BB%88%E4%BC%98%E5%8C%96"><span class="toc-number">21.</span> <span class="toc-text">4. 最终优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E9%A1%B9%E7%9B%AE%E6%89%93%E5%8C%85"><span class="toc-number">22.</span> <span class="toc-text">5. 项目打包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#React-%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0%EF%BC%88%E5%8D%81%E4%B8%83%EF%BC%89%E2%80%93-React-%E6%89%A9%E5%B1%95"><span class="toc-number">23.</span> <span class="toc-text">React 入门学习（十七）– React 扩展</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E8%A8%80-3"><span class="toc-number">24.</span> <span class="toc-text">引言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-setState"><span class="toc-number">25.</span> <span class="toc-text">1. setState</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E5%BC%8F-setState"><span class="toc-number">25.1.</span> <span class="toc-text">对象式 setState</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%BC%8F-setState"><span class="toc-number">25.2.</span> <span class="toc-text">函数式 setState</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-LazyLoad"><span class="toc-number">26.</span> <span class="toc-text">2. LazyLoad</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Hooks"><span class="toc-number">27.</span> <span class="toc-text">3. Hooks</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#useState"><span class="toc-number">27.1.</span> <span class="toc-text">useState</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#useEffect"><span class="toc-number">27.2.</span> <span class="toc-text">useEffect</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#useRef"><span class="toc-number">27.3.</span> <span class="toc-text">useRef</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Fragment"><span class="toc-number">28.</span> <span class="toc-text">4. Fragment</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Context"><span class="toc-number">29.</span> <span class="toc-text">5. Context</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%85%E9%80%82%E7%94%A8%E4%BA%8E%E7%B1%BB%E5%BC%8F%E7%BB%84%E4%BB%B6"><span class="toc-number">29.0.1.</span> <span class="toc-text">仅适用于类式组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%82%E7%94%A8%E4%BA%8E%E5%87%BD%E6%95%B0%E5%92%8C%E7%B1%BB%E5%BC%8F%E7%BB%84%E4%BB%B6"><span class="toc-number">29.0.2.</span> <span class="toc-text">适用于函数和类式组件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-PureComponent"><span class="toc-number">30.</span> <span class="toc-text">6. PureComponent</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-render-props"><span class="toc-number">31.</span> <span class="toc-text">7. render props</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-ErrorBoundary"><span class="toc-number">32.</span> <span class="toc-text">8. ErrorBoundary</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93"><span class="toc-number">33.</span> <span class="toc-text">9. 组件通信方式总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#React%E6%A0%B8%E5%BF%83-%E2%80%93-React-Hooks"><span class="toc-number">34.</span> <span class="toc-text">React核心 – React-Hooks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hooks-%E5%AD%98%E5%9C%A8%E7%9A%84%E6%84%8F%E4%B9%89"><span class="toc-number">35.</span> <span class="toc-text">hooks 存在的意义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">36.</span> <span class="toc-text">应用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hooks-API"><span class="toc-number">37.</span> <span class="toc-text">hooks API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-useState"><span class="toc-number">37.1.</span> <span class="toc-text">1. useState</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-useEffect"><span class="toc-number">37.2.</span> <span class="toc-text">2. useEffect</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-useLayoutEffect"><span class="toc-number">37.3.</span> <span class="toc-text">3. useLayoutEffect</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-useMemo"><span class="toc-number">37.4.</span> <span class="toc-text">4. useMemo</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-useCallback"><span class="toc-number">37.4.1.</span> <span class="toc-text">5. useCallback</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-useRef"><span class="toc-number">37.5.</span> <span class="toc-text">6. useRef</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-useContext"><span class="toc-number">37.6.</span> <span class="toc-text">7. useContext</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-useReducer"><span class="toc-number">37.7.</span> <span class="toc-text">8. useReducer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-%E8%87%AA%E5%AE%9A%E4%B9%89-hooks"><span class="toc-number">37.8.</span> <span class="toc-text">9. 自定义 hooks</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/12/03/neuralcoref-de-an-zhuang-yu-shi-yong/" title="neuralcoref的安装与使用"><img src="https://zyydgrbk.oss-cn-chengdu.aliyuncs.com/images/Snipaste_2023-11-10_10-23-14.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="neuralcoref的安装与使用"/></a><div class="content"><a class="title" href="/2023/12/03/neuralcoref-de-an-zhuang-yu-shi-yong/" title="neuralcoref的安装与使用">neuralcoref的安装与使用</a><time datetime="2023-12-03T08:01:20.000Z" title="发表于 2023-12-03 16:01:20">2023-12-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/11/10/bo-ke-you-hua-er/" title="博客优化二"><img src="https://zyydgrbk.oss-cn-chengdu.aliyuncs.com/images/Snipaste_2023-11-10_10-22-16.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="博客优化二"/></a><div class="content"><a class="title" href="/2023/11/10/bo-ke-you-hua-er/" title="博客优化二">博客优化二</a><time datetime="2023-11-10T02:19:16.000Z" title="发表于 2023-11-10 10:19:16">2023-11-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/11/06/tu-yu-tu-xue-xi/" title="图与图学习"><img src="https://zyydgrbk.oss-cn-chengdu.aliyuncs.com/images/fengmian4.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="图与图学习"/></a><div class="content"><a class="title" href="/2023/11/06/tu-yu-tu-xue-xi/" title="图与图学习">图与图学习</a><time datetime="2023-11-06T14:37:54.000Z" title="发表于 2023-11-06 22:37:54">2023-11-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/31/paddlepaddle-shang-shou/" title="PaddlePaddle上手"><img src="https://zyydgrbk.oss-cn-chengdu.aliyuncs.com/images/Snipaste_2023-10-07_15-20-15.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="PaddlePaddle上手"/></a><div class="content"><a class="title" href="/2023/10/31/paddlepaddle-shang-shou/" title="PaddlePaddle上手">PaddlePaddle上手</a><time datetime="2023-10-31T12:36:14.000Z" title="发表于 2023-10-31 20:36:14">2023-10-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/26/tu-shen-jing-wang-luo-coding/" title="图神经网络coding"><img src="https://zyydgrbk.oss-cn-chengdu.aliyuncs.com/images/Snipaste_2023-10-07_15-20-31.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="图神经网络coding"/></a><div class="content"><a class="title" href="/2023/10/26/tu-shen-jing-wang-luo-coding/" title="图神经网络coding">图神经网络coding</a><time datetime="2023-10-26T02:31:50.000Z" title="发表于 2023-10-26 10:31:50">2023-10-26</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">&copy;2023 By 邹阳</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, this is zy's blog, welcome!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://npm.elemecdn.com/vue@2.6.11"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>var gitcalendar = new Vue({
  el: '#gitcalendar',
  data: {
    simplemode: true, 
    user: 'YangZouy',
    fixed: 'fixed',
    px: 'px',
    x: '',
    y: '',
    span1: '',
    span2: '',
    month: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],
    monthchange: [],
    oneyearbeforeday: '',
    thisday: '',
    amonthago: '',
    aweekago: '',
    //- 最近一周数据
    weekdatacore: 0,
    datacore: 0,
    total: 0,
    datadate: '',
    data: [],
    positionplusdata: [],
    firstweek: [],
    lastweek: [],
    beforeweek: [],
    //- 最近一月数据
    thisweekdatacore: 0,
    mounthbeforeday: 0,
    mounthfirstindex: 0,
    crispedges: 'crispedges',
    thisdayindex: 0,
    amonthagoindex: 0,
    amonthagoweek: [],
    firstdate: [],
    first2date: [],
    montharrbefore: [],
    monthindex: 0,
    color: ['#f7f0f7', '#f5e1e8', '#f2c9d5', '#ebaec2', '#d689a3', '#de8ea9', '#cf5b81', '#c44771', '#bf3462', '#ab204f', '#ab0f43']
  },
  methods: {
    selectStyle(data, event) {
      document.querySelector('.angle-wrapper').style.display = 'block'
      this.span1 = data.date;
      //- this.span2 = data.count;
      this.span2 = data.intensity;
      this.x = event.clientX - 100;
      this.y = event.clientY - 60
    },
    outStyle() {
      document.querySelector('.angle-wrapper').style.display = 'none'
    },
    thiscolor(x) {
      if (x === 0) {
        let i = parseInt(x / 2);
        return this.color[0]
      } else if (x < 2) {
        return this.color[1]
      } else if (x < 20) {
        let i = parseInt(x / 2);
        return this.color[i]
      } else {
        return this.color[9]
      }
    },
  }
});
var apiurl = '' ? 'https:///api?' : 'https://githubapi.ryanchristian.dev/user/'
var githubapiurl = apiurl + gitcalendar.user;
//canvas绘图
function responsiveChart() {
  let c = document.getElementById("gitcanvas");
  if (c) {
    let cmessage = document.getElementById("gitmessage");
    let ctx = c.getContext("2d");
    c.width = document.getElementById("gitcalendarcanvasbox").offsetWidth;
    let linemaxwitdh = 0.96 * c.width / gitcalendar.data.length;
    c.height = 9 * linemaxwitdh;
    let lineminwitdh = 0.8 * linemaxwitdh;
    let setposition = {
      x: 0.02 * c.width,
      y: 0.025 * c.width
    };
    for (let week in gitcalendar.data) {
      weekdata = gitcalendar.data[week];
      for (let day in weekdata) {
        let dataitem = {
          date: "",
          //- count: "",
          intensity: "",
          x: 0,
          y: 0
        };
        gitcalendar.positionplusdata.push(dataitem);
        //- ctx.fillStyle = gitcalendar.thiscolor(weekdata[day].count);
        ctx.fillStyle = gitcalendar.thiscolor(weekdata[day].intensity);
        setposition.y = Math.round(setposition.y * 100) / 100;
        dataitem.date = weekdata[day].date;
        //- dataitem.count = weekdata[day].count;
        dataitem.intensity = weekdata[day].intensity;
        dataitem.x = setposition.x;
        dataitem.y = setposition.y;
        ctx.fillRect(setposition.x, setposition.y, lineminwitdh, lineminwitdh);
        setposition.y = setposition.y + linemaxwitdh
      };
      setposition.y = 0.025 * c.width;
      setposition.x = setposition.x + linemaxwitdh
    };
    ctx.font = "600  Arial";
    ctx.fillStyle = '#aaa';
    ctx.fillText("日", 0, 1.9 * linemaxwitdh);
    ctx.fillText("二", 0, 3.9 * linemaxwitdh);
    ctx.fillText("四", 0, 5.9 * linemaxwitdh);
    ctx.fillText("六", 0, 7.9 * linemaxwitdh);
    let monthindexlist = c.width / 24;
    for (let index in gitcalendar.monthchange) {
      ctx.fillText(gitcalendar.monthchange[index], monthindexlist, 0.7 * linemaxwitdh);
      monthindexlist = monthindexlist + c.width / 12
    };
    cmessage.onmousemove = function(event) {
      document.querySelector('.angle-wrapper').style.display = 'none'
    };
    c.onmousemove = function(event) {
      document.querySelector('.angle-wrapper').style.display = 'none'
      getMousePos(c, event);
    };

    function getMousePos(canvas, event) {
      var rect = canvas.getBoundingClientRect();
      var x = event.clientX - rect.left * (canvas.width / rect.width);
      var y = event.clientY - rect.top * (canvas.height / rect.height);
      //console.log("x:"+x+",y:"+y);
      for (let item of gitcalendar.positionplusdata) {
        let lenthx = x - item.x;
        let lenthy = y - item.y;
        //console.log(lenthx,lenthy);
        if (0 < lenthx && lenthx < lineminwitdh) {
          if (0 < lenthy && lenthy < lineminwitdh) {
            //console.log(item.date,item.count)
            document.querySelector('.angle-wrapper').style.display = 'block'
            gitcalendar.span1 = item.date;
            //- gitcalendar.span2 = item.count;
            gitcalendar.span2 = item.intensity;
            gitcalendar.x = event.clientX - 100;
            gitcalendar.y = event.clientY - 60
          }
        }
        //if(0< x - item.x <lineminwitdh&&0< y - item.y <lineminwitdh){
        //console.log(item.count,item.date);
        //}
      }
    }
  }
}
//数据统计算法
function addlastmonth() {
  if (gitcalendar.thisdayindex === 0) {
    thisweekcore(52);
    thisweekcore(51);
    thisweekcore(50);
    thisweekcore(49);
    thisweekcore(48);
  
    gitcalendar.thisweekdatacore += parseInt(gitcalendar.firstdate[6].intensity);
    gitcalendar.amonthago = gitcalendar.firstdate[6].date
  } else {
    thisweekcore(52);
    thisweekcore(51);
    thisweekcore(50);
    thisweekcore(49);
    thisweek2core();
    gitcalendar.amonthago = gitcalendar.first2date[gitcalendar.thisdayindex - 1].date
  }
};

function thisweek2core() {
  for (let i = gitcalendar.thisdayindex - 1; i < gitcalendar.first2date.length; i++) {
  
    gitcalendar.thisweekdatacore += parseInt(gitcalendar.first2date[i].intensity)
  }
};

function thisweekcore(index) {
  for (let item of gitcalendar.data[index]) {
    gitcalendar.thisweekdatacore += parseInt(item.intensity)
  }
};

function addlastweek() {
  for (let item of gitcalendar.lastweek) {
    gitcalendar.weekdatacore += parseInt(item.intensity)
  }
};

function addbeforeweek() {
  for (let i = gitcalendar.thisdayindex; i < gitcalendar.beforeweek.length; i++) {
    gitcalendar.weekdatacore += parseInt(gitcalendar.beforeweek[i].intensity)
  }
};

function addweek(data) {
  if (gitcalendar.thisdayindex === 6) {
    gitcalendar.aweekago = gitcalendar.lastweek[0].date;
    addlastweek()
  } else {
    lastweek = data.contributions[51];
    gitcalendar.aweekago = lastweek[gitcalendar.thisdayindex + 1].date;
    addlastweek();
    addbeforeweek()
  }
}

fetch(githubapiurl)
  .then(data => data.json())
  .then(data => {
    gitcalendar.data = data.contributions;
    gitcalendar.total = data.total;
    gitcalendar.first2date = gitcalendar.data[48];
    gitcalendar.firstdate = gitcalendar.data[47];
    gitcalendar.firstweek = data.contributions[0];
    gitcalendar.lastweek = data.contributions[52];
    gitcalendar.beforeweek = data.contributions[51];
    gitcalendar.thisdayindex = gitcalendar.lastweek.length - 1;
    gitcalendar.thisday = gitcalendar.lastweek[gitcalendar.thisdayindex].date;
    gitcalendar.oneyearbeforeday = gitcalendar.firstweek[0].date;
    gitcalendar.monthindex = gitcalendar.thisday.substring(5, 7) * 1;
    gitcalendar.montharrbefore = gitcalendar.month.splice(gitcalendar.monthindex, 12 - gitcalendar.monthindex);
    gitcalendar.monthchange = gitcalendar.montharrbefore.concat(gitcalendar.month);
    addweek(data);
    addlastmonth();
    responsiveChart();
  })
  .catch(function(error) {
    console.log(error);
  });

//手机版更换为svg绘制
if (document.getElementById("gitcalendarcanvasbox").offsetWidth < 500) {
  gitcalendar.simplemode = false
}

//当改变窗口大小时重新绘制canvas
window.onresize = function() {
  if (gitcalendar.simplemode) responsiveChart()
}

//解决滚动滑轮时出现的标签显示
window.onscroll = function() {
  if (document.querySelector('.angle-wrapper')) {
    document.querySelector('.angle-wrapper').style.display = 'none'
  }
};</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>